<!DOCTYPE html>
diff --git a/index.html b/index.html
index 184667d8765e045afb40fabb072a152dd429f2a5..1c461412224475339c9a49928adb168dca29735c 100644
--- a/index.html
+++ b/index.html
@@ -4,291 +4,465 @@
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</title>
 
 <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
 <script src="questions.js"></script>
 
 <style>
 body{
 margin:0;
 font-family:sans-serif;
 background:radial-gradient(circle,#1a1a2e,#0f0c29);
 color:white;
 display:flex;
 justify-content:center;
 align-items:center;
 min-height:100vh;
 }
 .container{
 background:rgba(255,255,255,0.07);
 backdrop-filter:blur(10px);
 padding:20px;
 border-radius:20px;
 width:95%;
-max-width:500px;
+max-width:560px;
 box-shadow:0 0 30px rgba(0,0,0,0.7);
 }
 input,button{
 width:100%;
 padding:12px;
 margin:6px 0;
 border:none;
 border-radius:10px;
 font-size:16px;
 }
 button{
 background:linear-gradient(45deg,#667eea,#764ba2);
 color:white;
 font-weight:bold;
+cursor:pointer;
 }
-button:hover{opacity:0.9}
+button:disabled{opacity:0.5;cursor:not-allowed}
+button:hover:not(:disabled){opacity:0.9}
 .card{
 background:rgba(255,255,255,0.1);
 padding:10px;
 border-radius:10px;
 margin:5px 0;
+display:flex;
+justify-content:space-between;
+align-items:center;
+gap:8px;
 }
 .host{border:2px solid gold}
+.question{text-align:center;margin:15px 0;font-size:19px;font-weight:bold}
+.phase-banner{
+text-align:center;
+padding:10px;
+border-radius:10px;
+font-size:18px;
+font-weight:bold;
+background:rgba(255,255,255,0.14);
+margin-bottom:10px;
+}
+.inline-btn{width:auto;padding:8px 12px;font-size:14px;margin:0}
+.danger{background:linear-gradient(45deg,#e63946,#b5179e)}
+.success{color:#8dff9e;font-weight:bold}
+.warning{color:#ffd166;font-weight:bold}
 .vote.selected{background:#ff4d6d}
-.question{text-align:center;margin:15px 0;font-size:18px}
+.answers-box{background:rgba(255,255,255,0.09);padding:10px;border-radius:10px;margin:8px 0}
 </style>
 </head>
 <body>
 
 <div class="container" id="app"></div>
 
 <script>
 
 var firebaseConfig={
 apiKey:"AIzaSyBgU2e3nrFc6k741ghQdB7UqqwNYaEvATk",
 authDomain:"bra-alsalfa.firebaseapp.com",
 databaseURL:"https://bra-alsalfa-default-rtdb.europe-west1.firebasedatabase.app"
 };
 
 firebase.initializeApp(firebaseConfig);
 var db=firebase.database();
 
 let gameCode=null;
 let playerId=null;
 let playerName=null;
 let gameData=null;
+let answerDraft="";
 
 function rand(){return Math.random().toString(36).substr(2,9)}
 
+function escapeHTML(str){
+return (str||"").replace(/[&<>"]/g,function(ch){
+return ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"})[ch];
+});
+}
+
 function renderHome(){
 document.getElementById("app").innerHTML=`
 <h2>ğŸ­ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©</h2>
 <input id="name" placeholder="Ø§Ø³Ù…Ùƒ">
 <input id="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
 <button onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
 <button onclick="joinRoom()">Ø¯Ø®ÙˆÙ„ ØºØ±ÙØ©</button>
 `;
 }
 
 function listen(){
 firebase.database().ref("games/"+gameCode).on("value",snap=>{
 gameData=snap.val();
-if(!gameData){ renderHome(); return; }
+if(!gameData){
+alert("ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù†Ù‡Ø§.");
+cleanupLocalState();
+renderHome();
+return;
+}
+if(!gameData.players || !gameData.players[playerId]){
+alert("ØªÙ… Ø¥Ø®Ø±Ø§Ø¬Ùƒ Ù…Ù† Ø§Ù„ØºØ±ÙØ©.");
+cleanupLocalState();
+renderHome();
+return;
+}
 renderGame();
 });
 }
 
+function cleanupLocalState(){
+if(gameCode){
+firebase.database().ref("games/"+gameCode).off();
+}
+gameCode=null;
+playerId=null;
+playerName=null;
+gameData=null;
+answerDraft="";
+}
+
 function createRoom(){
 playerName=document.getElementById("name").value.trim();
 if(!playerName)return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
 
 gameCode=Math.floor(1000+Math.random()*9000).toString();
 playerId=rand();
 
 firebase.database().ref("games/"+gameCode).set({
 status:"waiting",
 round:0,
+phaseMessage:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©",
 players:{
 [playerId]:{name:playerName,score:0,isHost:true}
-}
+},
+answers:{},
+votes:{}
 });
 
 listen();
 }
 
 function joinRoom(){
 playerName=document.getElementById("name").value.trim();
 gameCode=document.getElementById("code").value.trim();
 if(!playerName||!gameCode)return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯");
 
 playerId=rand();
 
 firebase.database().ref("games/"+gameCode+"/players/"+playerId).set({
 name:playerName,score:0,isHost:false
-});
-
-listen();
+}).then(()=>listen()).catch(()=>alert("Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©"));
 }
 
 function isHost(){
-return gameData.players[playerId]?.isHost;
+return !!gameData?.players?.[playerId]?.isHost;
+}
+
+function getPhaseTitle(){
+const map={
+waiting:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø§Ø³ØªØ±",
+writing:"Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©",
+reveal_answers:"ØªÙ… ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª",
+reveal_imposter_question:"ØªÙ… ÙƒØ´Ù Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ±",
+voting:"Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØµÙˆÙŠØª",
+result:"Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø©"
+};
+return gameData.phaseMessage || map[gameData.status] || "";
 }
 
 function startGame(){
 if(!isHost())return;
 
-let ids=Object.keys(gameData.players);
-if(ids.length<2||ids.length>5)return alert("2-5 Ù„Ø§Ø¹Ø¨ÙŠÙ†");
+let ids=Object.keys(gameData.players||{});
+if(ids.length<3)return alert("Ù„Ø§Ø²Ù… 3 Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£Ùˆ Ø£ÙƒØ«Ø±");
 
 let imp=ids[Math.floor(Math.random()*ids.length)];
 let q=QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
+answerDraft="";
 
 firebase.database().ref("games/"+gameCode).update({
 status:"writing",
+round:(gameData.round||0)+1,
+phaseMessage:"âœï¸ Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø§Ù„Ø¢Ù†",
 imposterId:imp,
 normalQuestion:q.normal,
 imposterQuestion:q.imposter,
 answers:{},
-votes:{}
+votes:{},
+lastVotes:{},
+voteCount:{},
+revealedImposter:false
 });
 }
 
 function submitAnswer(){
-let val=document.getElementById("answer").value.trim();
-if(!val)return;
-firebase.database().ref("games/"+gameCode+"/answers/"+playerId).set(val);
+let val=(document.getElementById("answer")?.value||"").trim();
+if(!val)return alert("Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©");
+firebase.database().ref("games/"+gameCode+"/answers/"+playerId).set(val).then(()=>{
+answerDraft=val;
+});
+}
+
+function revealAnswers(){
+if(!isHost())return;
+const totalPlayers=Object.keys(gameData.players||{}).length;
+const answered=Object.keys(gameData.answers||{}).length;
+if(answered<totalPlayers)return alert("Ù„Ø§Ø²Ù… ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØ¬Ø§ÙˆØ¨ÙˆÙ† Ù‚Ø¨Ù„ ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª");
+
+firebase.database().ref("games/"+gameCode).update({
+status:"reveal_answers",
+phaseMessage:"ğŸ“¢ ØªÙ… ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª"
+});
+}
+
+function revealImposterQuestion(){
+if(!isHost())return;
+firebase.database().ref("games/"+gameCode).update({
+status:"reveal_imposter_question",
+phaseMessage:"ğŸ•µï¸ ØªÙ… ÙƒØ´Ù Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ±",
+revealedImposter:true
+});
 }
 
 function startVoting(){
 if(!isHost())return;
-firebase.database().ref("games/"+gameCode).update({status:"voting"});
-startTimer();
+firebase.database().ref("games/"+gameCode).update({
+status:"voting",
+phaseMessage:"ğŸ—³ï¸ Ø¨Ø¯Ø£ Ø§Ù„ØªØµÙˆÙŠØª"
+});
 }
 
 function vote(id){
 if(gameData.votes?.[playerId])return;
 firebase.database().ref("games/"+gameCode+"/votes/"+playerId).set(id);
 }
 
-function startTimer(){
-let t=5;
-let int=setInterval(()=>{
-let el=document.getElementById("timer");
-if(el)el.innerText=t;
-t--;
-if(t<0){clearInterval(int);finishRound();}
-},1000);
+function endVoting(){
+if(!isHost())return;
+finishRound();
 }
 
 function finishRound(){
 if(!isHost())return;
 
 let votes=gameData.votes||{};
 let count={};
-for(let v in votes){
-count[votes[v]]=(count[votes[v]]||0)+1;
-}
-
-let accused=null,max=0;
-for(let id in count){
-if(count[id]>max){max=count[id];accused=id;}
+for(let voter in votes){
+let votedId=votes[voter];
+count[votedId]=(count[votedId]||0)+1;
 }
 
 let imp=gameData.imposterId;
+let impVotes=count[imp]||0;
 let updates={};
 
-if(accused===imp){
-for(let v in votes){
-if(votes[v]===imp){
-let s=gameData.players[v].score||0;
-updates["games/"+gameCode+"/players/"+v+"/score"]=s+1;
+if(impVotes>0){
+for(let voter in votes){
+if(votes[voter]===imp){
+let s=gameData.players[voter].score||0;
+updates["games/"+gameCode+"/players/"+voter+"/score"]=s+1;
 }
 }
-let s=gameData.players[imp].score||0;
-updates["games/"+gameCode+"/players/"+imp+"/score"]=s-1;
+let sImp=gameData.players[imp].score||0;
+updates["games/"+gameCode+"/players/"+imp+"/score"]=sImp-1;
 }else{
-let s=gameData.players[imp].score||0;
-updates["games/"+gameCode+"/players/"+imp+"/score"]=s+1;
+let sImp=gameData.players[imp].score||0;
+updates["games/"+gameCode+"/players/"+imp+"/score"]=sImp+1;
 }
 
 updates["games/"+gameCode+"/status"]="result";
+updates["games/"+gameCode+"/phaseMessage"]="ğŸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØµÙˆÙŠØª";
 updates["games/"+gameCode+"/lastVotes"]=votes;
+updates["games/"+gameCode+"/voteCount"]=count;
 
 firebase.database().ref().update(updates);
 }
 
 function nextRound(){
 if(!isHost())return;
-firebase.database().ref("games/"+gameCode).update({status:"waiting"});
+answerDraft="";
+firebase.database().ref("games/"+gameCode).update({
+status:"waiting",
+phaseMessage:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©",
+answers:{},
+votes:{},
+lastVotes:{},
+voteCount:{},
+revealedImposter:false
+});
 }
 
-function renderGame(){
+function leaveRoom(){
+if(!gameCode||!playerId)return;
+const wasHost=isHost();
+const players=gameData.players||{};
+const ids=Object.keys(players).filter(id=>id!==playerId);
+const updates={};
+updates["games/"+gameCode+"/players/"+playerId]=null;
+updates["games/"+gameCode+"/answers/"+playerId]=null;
+updates["games/"+gameCode+"/votes/"+playerId]=null;
+
+if(wasHost){
+if(ids.length===0){
+updates["games/"+gameCode]=null;
+}else{
+updates["games/"+gameCode+"/players/"+ids[0]+"/isHost"]=true;
+}
+}
+
+firebase.database().ref().update(updates).finally(()=>{
+cleanupLocalState();
+renderHome();
+});
+}
 
-let playersHTML="";
+function kickPlayer(id){
+if(!isHost()||id===playerId)return;
+if(!confirm("Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ¨ÙŠ ØªØ·Ù„Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŸ"))return;
+
+const updates={};
+updates["games/"+gameCode+"/players/"+id]=null;
+updates["games/"+gameCode+"/answers/"+id]=null;
+updates["games/"+gameCode+"/votes/"+id]=null;
+firebase.database().ref().update(updates);
+}
+
+function renderPlayers(){
+let answers=gameData.answers||{};
+let list="";
 for(let id in gameData.players){
 let p=gameData.players[id];
-playersHTML+=`
+let answered=answers[id]?" âœ…":" â³";
+list+=`
 <div class="card ${p.isHost?'host':''}">
-${p.name} (${p.score})
-${p.isHost?"ğŸ‘‘":""}
+  <div>${escapeHTML(p.name)} (${p.score}) ${p.isHost?"ğŸ‘‘":""}${gameData.status==="writing"?answered:""}</div>
+  ${isHost()&&!p.isHost?`<button class="inline-btn danger" onclick="kickPlayer('${id}')">Ø¥Ø®Ø±Ø§Ø¬</button>`:""}
 </div>`;
 }
+return list;
+}
 
+function renderVotesBreakdown(votes){
+let html="";
+for(let voter in gameData.players){
+if(votes[voter]){
+html+=`${escapeHTML(gameData.players[voter].name)} âœ ${escapeHTML(gameData.players[votes[voter]]?.name||"-")}<br>`;
+}else{
+html+=`${escapeHTML(gameData.players[voter].name)} âœ Ù„Ù… ÙŠØµÙˆÙ‘Øª<br>`;
+}
+}
+return html;
+}
+
+function renderGame(){
+let playersHTML=renderPlayers();
 let content="";
+const myAnswer=gameData.answers?.[playerId];
 
 switch(gameData.status){
-
 case "waiting":
 content=isHost()?`<button onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>`:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø§Ø³ØªØ±";
 break;
 
 case "writing":
-let q=(playerId===gameData.imposterId)?
-gameData.imposterQuestion:
-gameData.normalQuestion;
+let q=(playerId===gameData.imposterId)?gameData.imposterQuestion:gameData.normalQuestion;
+let myInputValue=myAnswer||answerDraft||"";
+let everyoneAnswered=Object.keys(gameData.answers||{}).length===Object.keys(gameData.players||{}).length;
+content=`
+<div class="question">${escapeHTML(q)}</div>
+<input id="answer" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ" value="${escapeHTML(myInputValue)}" ${myAnswer?"disabled":""} oninput="answerDraft=this.value">
+<button onclick="submitAnswer()" ${myAnswer?"disabled":""}>${myAnswer?"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…":"Ø¥Ø±Ø³Ø§Ù„"}</button>
+${myAnswer?`<div class="success">Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù…Ø­ÙÙˆØ¸Ø©.</div>`:""}
+${isHost()?`<button onclick="revealAnswers()" ${everyoneAnswered?"":"disabled"}>ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
+${!everyoneAnswered?'<div class="warning">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø¬Ø§Ø¨Ø§Øª ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.</div>':''}`:""}
+`;
+break;
 
+case "reveal_answers":
+let answersHTML="";
+for(let id in gameData.players){
+answersHTML+=`<div class="answers-box"><b>${escapeHTML(gameData.players[id].name)}:</b> ${escapeHTML(gameData.answers?.[id]||"-")}</div>`;
+}
+content=`
+<div>${answersHTML}</div>
+${isHost()?'<button onclick="revealImposterQuestion()">ÙƒØ´Ù Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ±</button>':""}
+`;
+break;
+
+case "reveal_imposter_question":
+let answersHTML2="";
+for(let id in gameData.players){
+answersHTML2+=`<div class="answers-box"><b>${escapeHTML(gameData.players[id].name)}:</b> ${escapeHTML(gameData.answers?.[id]||"-")}</div>`;
+}
 content=`
-<div class="question">${q}</div>
-<input id="answer" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ">
-<button onclick="submitAnswer()">Ø¥Ø±Ø³Ø§Ù„</button>
+<div>${answersHTML2}</div>
+<div class="question">Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ±: ${escapeHTML(gameData.imposterQuestion)}</div>
 ${isHost()?'<button onclick="startVoting()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</button>':""}
 `;
 break;
 
 case "voting":
 let btns="";
 for(let id in gameData.players){
 if(id!==playerId){
-btns+=`<button class="vote ${gameData.votes?.[playerId]===id?'selected':''}" onclick="vote('${id}')">${gameData.players[id].name}</button>`;
+btns+=`<button class="vote ${gameData.votes?.[playerId]===id?'selected':''}" onclick="vote('${id}')">${escapeHTML(gameData.players[id].name)}</button>`;
 }
 }
 content=`
-<div>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ${gameData.normalQuestion}</div>
-<div id="timer">5</div>
+<div>Ø§Ù„ØªØµÙˆÙŠØª Ø§Ø®ØªÙŠØ§Ø±ÙŠ. ØªÙ‚Ø¯Ø± ØªØµÙˆÙ‘Øª Ù…Ø±Ø© ÙˆØ­Ø¯Ø© ÙÙ‚Ø·.</div>
 ${btns}
+<div class="answers-box">${renderVotesBreakdown(gameData.votes||{})}</div>
+${isHost()?'<button onclick="endVoting()">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</button>':""}
 `;
 break;
 
 case "result":
 let votes=gameData.lastVotes||{};
-let breakdown="";
-for(let v in votes){
-breakdown+=`${gameData.players[v].name} âœ ${gameData.players[votes[v]].name}<br>`;
-}
+let imp=gameData.imposterId;
+let impCaught=(gameData.voteCount?.[imp]||0)>0;
 content=`
-<div>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©: ${gameData.players[gameData.imposterId].name}</div>
-<div>${breakdown}</div>
+<div>Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ©: <b>${escapeHTML(gameData.players[imp]?.name||"-")}</b></div>
+<div>${impCaught?"ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ± ğŸ¯":"Ù…Ø§ Ø£Ø­Ø¯ ØµÙˆÙ‘Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù…Ø¨ÙˆØ³ØªØ± ğŸ™ˆ"}</div>
+<div class="answers-box">${renderVotesBreakdown(votes)}</div>
 ${isHost()?'<button onclick="nextRound()">Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>':""}
 `;
 break;
 }
 
 document.getElementById("app").innerHTML=`
-<h2>ğŸ­ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© | ${gameCode}</h2>
+<h2>ğŸ­ Ø¨Ø±Ø§ Ø§Ù„Ø³Ø§Ù„ÙØ© | ${gameCode||""}</h2>
+<div class="phase-banner">${escapeHTML(getPhaseTitle())}</div>
 ${playersHTML}
 ${content}
+<button class="danger" onclick="leaveRoom()">Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
 `;
 }
 
 renderHome();
 
 </script>
 
 </body>
 </html>
